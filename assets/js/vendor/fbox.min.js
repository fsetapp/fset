var jl=Object.defineProperty;var Hr=(e,t)=>{for(var r in t)jl(e,r,{get:t[r],enumerable:!0})};var Et,Ll=new Uint8Array(16);function rr(){if(!Et&&(Et=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Et))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Et(Ll)}var Yr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ul(e){return typeof e=="string"&&Yr.test(e)}var zr=Ul;var O=[];for(var nr=0;nr<256;++nr)O.push((nr+256).toString(16).substr(1));function Vl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(O[e[t+0]]+O[e[t+1]]+O[e[t+2]]+O[e[t+3]]+"-"+O[e[t+4]]+O[e[t+5]]+"-"+O[e[t+6]]+O[e[t+7]]+"-"+O[e[t+8]]+O[e[t+9]]+"-"+O[e[t+10]]+O[e[t+11]]+O[e[t+12]]+O[e[t+13]]+O[e[t+14]]+O[e[t+15]]).toLowerCase();if(!zr(r))throw TypeError("Stringified UUID is invalid");return r}var Jr=Vl;function Fl(e,t,r){e=e||{};var n=e.random||(e.rng||rr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=n[l];return t}return Jr(n)}var lr=Fl;var M=10,F=11,ie=12,C=13,G=14,j=15,I=16,oe=17,ae=18,se=19,ce=20,de=21,ue=22,fe=23;var pe=24,me=25;var he=26,ge=27,W=28,Te=29,Je=30,$t=31,L="fmodel",ve=()=>({t:Je}),At=()=>({t:oe}),Xr=()=>({t:he}),Qr=()=>({t:ae,min:-128,max:127}),Zr=()=>({t:ce,min:-32768,max:32767}),en=()=>({t:ue,min:-2147483648,max:2147483647}),tn=()=>({t:se,min:0,max:255}),rn=()=>({t:de,min:0,max:65535}),nn=()=>({t:fe,min:0,max:4294967295}),ln=()=>({t:pe}),on=()=>({t:me}),an=()=>({t:$t}),sn=()=>({t:ge}),H=()=>({t:M,fields:[]}),cn=()=>({t:F,schs:[S(()=>ke(null)),S(H)]}),dn=()=>({t:C,sch:S(ve)}),un=()=>({t:G,schs:[S(ve)]}),fn=()=>({t:j,schs:[S(ve)]}),pn=()=>({t:I,fields:[{...S(H),key:"tag_a"}],tagname:"tag",allowedSchs:[H()],keyPrefix:"tag"}),mn=()=>({t:ie,schs:[S(At),S(ve)]}),ke=(e,t)=>Object.assign({t:W,$r:e},t),St=e=>{try{return e=JSON.parse(e),e==null||["string","number","boolean"].includes(typeof e)?{t:Te,v:e}:!1}catch(t){return!1}},S=(e,t={})=>{let r=e();return r.$a||(r.$a=lr()),t.force&&(r.$a=lr()),r},Ee=e=>Gl[e],Gl={[M]:"record",[F]:"e_record",[ie]:"dict",[C]:"list",[G]:"tuple",[j]:"union",[I]:"tagged_union",[oe]:"string",[ae]:"int8",[se]:"uint8",[ce]:"int16",[de]:"uint16",[ue]:"int32",[fe]:"uint32",[pe]:"float32",[me]:"float64",[he]:"boolean",[ge]:"nil",[W]:"ref",[Te]:"value",[Je]:"any",[$t]:"timestamp"};var Xe=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},hn=e=>{Xe(e),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},{defineProperty:ql}=Object,Tn=ql,N=(e,t,r)=>Tn(e,t,{value:r,configurable:!0}),Ot=(e,t,r)=>Tn(e,t,{value:r,configurable:!0,writable:!0}),ir=function(e,t,r){var n=null;return function(){n&&clearTimeout(n);var l=arguments;n=setTimeout(function(){n=null,e.apply(r,l)},t)}},xn=(e,t)=>{for(let r=0;r<e.length;r++)if(t(e[r]))return e[r]},xe=(e,t)=>{for(let r=0;r<e.length;r++)t(e[r],r)},Qe=(e,t,r)=>{for(let n=0;n<e.length;n++)t(r,e[n]);return r};var Dt=(e,t)=>{let r=JSON.parse(JSON.stringify(e));return A(r,(n,l)=>S(()=>n,{force:!0})),r},yn=e=>JSON.parse(JSON.stringify(e)),or=({t:e,$a:t,key:r},{path:n,lpath:l,level:i})=>({t:e,$a:t,key:r,level:i,path:n,lpath:l}),ar=(e,t)=>{let r=e.slice(0);return r.push(t),r},A=(e,t,r={path:"",lpath:[e],level:1,parent:{}})=>{if(delete e._halt,delete e._pruned,e=t(e,r),e._halt||e._pruned)return e;switch(!0){case e.hasOwnProperty("fields"):xe(e.fields,(i,o)=>{let a=i.key,s={path:`${r.path}[${a}]`,level:r.level+1,index:o,parent:or(e,r),lpath:ar(r.lpath,i)};if(i=A(i,t,s),e.fields[o]=i,i._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("schs"):xe(e.schs,(i,o)=>{let a={path:`${r.path}[][${o}]`,level:r.level+1,index:o,parent:or(e,r),lpath:ar(r.lpath,i)};if(i=A(i,t,a),e.schs[o]=i,i._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("sch"):let n=e.sch,l={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:or(e,r),lpath:ar(r.lpath,n)};if(n=A(e.sch,t,l),e.sch=n,n._halt)return Object.assign(e,{_halt:!0});break;default:}return e},sr=(e,t,r)=>{let n={original:{},popped:[]};return A(e,(l,i)=>{if(typeof t=="function"&&!t.call(null,l,i))return l;if(typeof t!="function"&&i.path!=t)return l;{typeof t=="string"&&(l._halt=!0),typeof r=="function"&&(r=r.call(null,l,i));let o=r.sort((a,s)=>s-a);switch(!0){case l.hasOwnProperty("fields"):for(let a of o)n.popped.unshift({k:l.fields[a].key,sch:l.fields.splice(a,1)[0],index:a});break;case l.hasOwnProperty("sch"):break;case l.hasOwnProperty("schs"):for(let a of o)n.popped.unshift({k:a,sch:l.schs.splice(a,1)[0],index:a});l.schs.length==0&&l.schs.splice(0,0,S(ve));break;default:}return l}}),n},Kl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),Ze=(e,t,r)=>{let n={original:{},inserted:[]},l=(i,o)=>(i=Math.max(i,0),i=Math.min(i,o),i);return A(e,(i,o)=>{var a;if(typeof t=="function"&&!t.call(null,i,o))return i;if(typeof t!="function"&&o.path!=t)return i;{typeof t=="string"&&(i._halt=!0),typeof r=="function"&&(r=r.call(null,i,o));let s=r.sort((c,u)=>c.index-u.index);switch(!0){case i.hasOwnProperty("fields"):let c=(a=e.taggedLevel)==null?void 0:a[o.level+1],u=[],{keys:d,anchors:h}=Qe(i.fields,(p,y)=>(Object.assign(p.keys,{[y.key]:!0}),Object.assign(p.anchors,{[y.$a]:!0}),p),{keys:{},anchors:{}});for(let{k:p,sch:y,index:f}of s){if(h[y().$a])continue;for(p=p==0?"0":p,p=p||`${c||i.keyPrefix||"key"}_${Math.floor(Date.now()/100)}`,p=`${p}`;d[p];)p=`${p} \u2013`;d[p]=!0,f=l(f,i.fields.length+u.length);let x=S(y);x.key=p,x.index=f,u.push(x),n.inserted.push({k:x.key,sch:x,index:f})}s.length!=0&&i.fields.splice(s[0].index,0,...u);break;case i.hasOwnProperty("sch"):break;case i.hasOwnProperty("schs"):for(let{k:p,sch:y,index:f}of s){f=l(f,i.schs.length);let x=S(y);x.index=f,i.schs.splice(f,0,x),n.inserted.push({k:p,sch:i.schs[f],index:f})}break;default:}return i}}),n},It=(e,{isRefConstraint:t,dstPath:r,startIndex:n=0},l)=>{let i=(c,u,d)=>ye(c,u,(h,p)=>(N(h,"_pinId",d),h)),o=Symbol(r);i(e,r,o);let a=Mt(e,l,{dstPath:r,isRefConstraint:t});return cr(e,{dstPin:o,startIndex:n},a)},Mt=(e,t,r={})=>{let n={},l=Kl(Object.keys(t));r.isRefConstraint==null&&(r.isRefConstraint=!0);for(let i of l){let o=t[i],a=d=>{var h;return(h=o.find(p=>p.index==d))==null?void 0:h.newK};if(r.dstPath&&o.filter(h=>r.dstPath.startsWith(h.id)).length!=0)continue;let s=Qe(o,(d,h)=>(h.refed&&r.isRefConstraint&&`${r.dstLevel}`!=h.getAttribute("aria-level")?d.refed.push(h):d.indices.push(h.index),d),{indices:[],refed:[]});r.isRefConstraint&&xe(s.refed,d=>d.setAttribute("data-err","ref"));let u=sr(e,i,s.indices).popped.map(({k:d,sch:h,index:p})=>({k:a(p)||d,sch:()=>h}));n[i]=u}return n},cr=(e,{dstPin:t,dstPath:r,startIndex:n=0},l)=>{let i=(c,u)=>$e(c,(d,h)=>d._pinId==u,(d,h)=>(N(d,"_pinned",h),d));n=Math.max(n,0);let o={},a=Object.values(l).flatMap(c=>c).map((c,u)=>Object.assign(c,{index:n+u}));if(t){let c=i(e,t);c&&(r=c._pinned.path)}let s=Ze(e,r,a);return s.inserted.length!=0&&(o[r]=s.inserted),o},fr=(e,{dstPath:t,startIndex:r=0},n)=>{let l=dr(e,n,{dstPath:t,startIndex:r});return ur(e,{dstPath:t},l)},dr=(e,t,r={})=>Qe(Object.values(t),(n,l)=>{let i=l.map(a=>a.id),o=[];$e(e,(a,s)=>(i.includes(s.path)&&(N(a,"_meta",s),o.unshift(a)),o.length==i.length),(a,s)=>a);for(let a of l){if(r.dstPath&&r.dstPath.startsWith(a.id))continue;let s=o.find(c=>c._meta.path==a.id);s&&n.unshift({k:a.key,sch:()=>Dt(s,e),index:r.startIndex+n.length,id:a.id})}return n},[]),ur=(e,{dstPath:t},r)=>{let n={},l=Ze(e,t,r);return l.inserted.length!=0&&(n[t]=l.inserted),n},Pt=(e,t,r)=>ye(e,t,(n,l)=>{let i=S(r),{title:o,description:a,rw:s,required:c,$a:u,key:d}=n,h=i.t==W&&i.$r!=n.$r,p=i.t==Te&&i.v!=n.v,y=i.t!=n.t;return i.$r==u?n:y||p||h?Object.assign(i,{metadata:{title:o,description:a,rw:s,required:c},$a:u,key:d}):n}),q=(e,t)=>$e(e,(r,n)=>n.path==t,(r,n)=>(N(r,"_meta",n),r)),ye=(e,t,r)=>$e(e,(n,l)=>l.path==t,r),$e=(e,t,r)=>{let n;return A(e,(l,i)=>t(l,i)?(n=r(l,i),n._halt=!0,n):l),n&&delete n._halt,n};var pr={};Hr(pr,{clearClipboard:()=>Se,collapseSelected:()=>Tr,createWalker:()=>_n,ensureNodeConnected:()=>Ct,expandSelected:()=>hr,findUnselectedNode:()=>ut,reselectNodes:()=>tt,selectMultiNode:()=>Fe,selectMultiNodeTo:()=>dt,selectNode:()=>E,selectedGroupedByParent:()=>Ae,toggleSelectNode:()=>Nn});var K="aria-selected",Rt="aria-expanded",_n=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(K)){let n=(r=t.parentElement.closest(`[${Rt}]`))==null?void 0:r.getAttribute(Rt);return n&&n=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),E=(e,t,r={focus:!0})=>{t=Ct(e,t),!!t&&(e._walker.currentNode=t,wn(e),et(t),r.focus&&t.focus())},Nn=(e,t)=>{e&&(e.tabIndex=-1),bn(t)},Fe=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(K)=="true"?bn(e):et(t),r.focus&&t.focus())},wn=(e,t={})=>{t=Object.assign({sync:!0},t);for(let r of e.querySelectorAll(`[${K}='true']`))t.sync?jt(r):ir(jt,0)(r)},mr=(e,t,r,n={})=>{var o,a,s;let l=e._walker.currentNode,i=t();if(!!i){if(l==r)return(o=n.target)==null?void 0:o.call(null,r);(a=n.pre)==null||a.call(null,l,i),mr(e,t,r,n),(s=n.post)==null||s.call(null,l,i)}},dt=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,mr(e,()=>e._walker.nextSibling(),r,{pre:(n,l)=>{Fe(n,l,{focus:!1})}}),e._walker.currentNode=r,et(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,et(r.parentNode.closest(`[${K}]`)),mr(e,()=>e._walker.previousSibling(),r,{pre:(n,l)=>{Fe(n,l,{focus:!1})}}),jt(r.parentNode.closest(`[${K}]`)),e._walker.currentNode=r,et(r),r.focus();break}},et=e=>{!e||(e.setAttribute(K,!0),e.tabIndex=0)},jt=e=>{!e||(e.setAttribute(K,!1),e.tabIndex=-1)},bn=e=>(e==null?void 0:e.getAttribute(K))=="true"?jt(e):et(e),ut=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(K))=="true");return t},Bl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),tt=(e,t,r={})=>{wn(e,r);for(let n of Bl(Object.keys(t))){let l=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let i=parseInt(n.getAttribute("aria-level")),o=n.querySelectorAll(`[aria-level='${i+1}'][role='treeitem']`);for(let a=0;a<l.length;a++){let s=l[a].index,c=o[s];if(!c)return;r.direction&&c.classList.add(r.direction),Fe(o[s-1],c,{focus:!1}),e._walker.currentNode=c}r=Object.assign({sync:!0},r),r.sync?e._walker.currentNode.focus():ir(()=>e._walker.currentNode.focus())()}},Ae=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${K}='true']`}`),n={};for(let l=0;l<r.length;l++){let i=r[l],o=i.parentNode.closest("[role='treeitem']");if(!o)break;i.index=i.index||parseInt(i.getAttribute("aria-posinset"))-1,n[o.id]=n[o.id]||[],n[o.id].push(i)}return n},hr=e=>{let t=e.querySelectorAll(`[${K}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(Rt,"true")},Tr=e=>{let t=e.querySelectorAll(`[${K}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(Rt,"false")},Se=e=>{xe(e.querySelectorAll(".item-cutting, .item-copying, [data-err]"),t=>{t.classList.remove("item-cutting","item-copying"),t.removeAttribute("data-err")}),window._treeClipboard=null},Ct=(e,t)=>t&&!t.isConnected?t.id?e.querySelector(`[id='${CSS.escape(t.id)}']`):e.querySelector("[id]"):t;var Wl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();dt(e,t,r)},Hl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();dt(e,t,r)},Yl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();Fe(t,r)},zl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();Fe(t,r)},Jl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();E(e,t)},Xl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();E(e,t)},Ql=({tree:e})=>E(e,e._walker.previousNode()),Zl=({tree:e})=>E(e,e._walker.nextNode()),ei=({tree:e})=>{for(;e._walker.parentNode(););E(e,e._walker.nextNode()),E(e,e._walker.parentNode())},ti=({tree:e})=>{for(;e._walker.nextNode(););E(e,e._walker.currentNode)},ft=({tree:e},t={})=>E(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),pt=({tree:e,store:t},r)=>gn(e,t,r),Lt={selectMultiNodeUpTo:Wl,selectMultiNodeDownTo:Hl,selectMultiNodeUp:Yl,selectMultiNodeDown:zl,selectUpEnd:Jl,selectDownEnd:Xl,selectUp:Ql,selectDown:Zl,selectRoot:ei,selectLast:ti},J=({tree:e,store:t})=>{var o,a;let r=e._walker.currentNode,n=q(t,r.id),l,i=((o=xr(e,t))==null?void 0:o[0])||n._addSchDefault||n.allowedSchs&&n.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!i||(((a=t.put)==null?void 0:a.pos)=="prepend"?l=0:l=Number.MAX_SAFE_INTEGER,Ze(t,r.id,[{k:null,sch:()=>Dt(i),index:l}]),e._render(t),E(e,r))},rt=({tree:e,store:t})=>{var l,i;let r=e._walker.currentNode;if(((i=(l=r.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:i.group)=="keyed"){let o=r.querySelector(".k").getBoundingClientRect();vn({tree:e,store:t,editMode:"editKey",textRect:o})}},nt=({tree:e,store:t})=>{let r=e._walker.currentNode.querySelector(".t").getBoundingClientRect(),n=xr(e,t)||t.allowedSchs;vn({tree:e,store:t,editMode:"editType",textRect:r,opts:{allowedTs:n}})},vn=({tree:e,store:t,editMode:r,textRect:n,opts:l={}})=>{let i=e._walker.currentNode,o=ye(t,i.id,(c,u)=>Ot(c,"uiMode",r));e._render(t);let a=e.querySelector("textarea");if(!a)return;let s=window.getComputedStyle(a);a.style.minWidth=n.width+"px",a.style.minHeight=n.height+"px",a._treeItem=i,a.opts=l,a.onblur=c=>c.relatedTarget&&c.relatedTarget.id!=a._treeItem.id&&gn(e,t,a),a.focus()},gn=(e,t,r)=>{let n=ye(t,r._treeItem.id,(l,i)=>Object.assign(l,{uiMode:"cancelled-edit"}));e._render(t),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),E(e,e._walker.currentNode))},_e=({tree:e,store:t},r)=>{r.id=="key-edit"?kn(e,t,r,ni):r.id=="type-edit"&&kn(e,t,r,ri)},kn=(e,t,r,n)=>{let l=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),E(e,r._treeItem,{focus:!1});let i=n(e,t,r)||l.id;ye(t,i,(o,a)=>Object.assign(o,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(i)}']`),E(e,e._walker.currentNode)},ri=(e,t,r)=>{let n=xr(e,t)||t.allowedSchs,l=n.find(a=>Ee(a.t)==r.value),i=t._models[r.value]&&r.value||Object.keys(t._models).find(a=>{let s=t._models[a];return t._models[a].display==r.value?n.find(u=>{if(u.t==ke(null).t)return u.to?u.to.t==s.sch.t:!0}):!1}),o=St(r.value);return l?Pt(t,r._treeItem.id,()=>Dt(l)):i?Pt(t,r._treeItem.id,()=>ke(i)):o&&Pt(t,r._treeItem.id,()=>o),e._walker.currentNode.id},ni=(e,t,r)=>{let n=Ae(e),l=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let i=n[r.dataset.parentPath][0].index,a=It(t,{dstPath:l,startIndex:i},n)[l][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${a}]`},B=({tree:e,store:t})=>{let r=ut(()=>e._walker.nextSibling())||ut(()=>e._walker.previousSibling())||ut(()=>e._walker.parentNode());Mt(t,Ae(e)),e._render(t),E(e,r)},mt=({tree:e,store:t})=>{var n;let r=e._walker.currentNode;!r||((n=t.entryable)==null?void 0:n.includes(r.dataset.tag))&&(ye(t,r.id,(l,i)=>Object.assign(l,{isEntry:!0})),e._render(t),E(e,r))};var Ge=({store:e,tree:t})=>{Se(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=Ae(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStoreKey:e.key,ops:({dstPath:n,dstLevel:l})=>Mt(e,r,{dstPath:n,dstLevel:l}),selected:r}},qe=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;Se(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=Ae(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStoreKey:e.key,ops:({dstPath:n})=>dr(e,r,{dstPath:n,startIndex:0}),selected:r}},X=({tree:e,store:t,srcStore:r})=>{var l;let n=q(t,e._walker.currentNode.id);if(!!(n.hasOwnProperty("fields")||n.hasOwnProperty("schs")||n.hasOwnProperty("sch"))&&!(((l=t.put)==null?void 0:l.onlyDst)&&!t.put.onlyDst[t.taggedLevel[n._meta.level]])&&window._treeClipboard){let i=e._walker.currentNode.id,{type:o,srcStoreKey:a,ops:s,selected:c}=window._treeClipboard,u=c,d={};if(t.key==a)switch(o){case"copy":d=fr(t,{dstPath:i},u);break;case"cut":d=It(t,{dstPath:i,dstLevel:n._meta.level},u);break}else switch(o){case"copy":let p=s({dstPath:""});d=ur(t,{dstPath:i},p);break;case"cut":let y=s({dstPath:"",dstLevel:n._meta.level});d=cr(t,{dstPath:i},y);break}let h=(p,y)=>{let f={};for(let x of Object.keys(y))x==n._meta.path?f[""]=y[x]:f[x]=y[x];p._render(n),Se(p),tt(p,f)};Object.keys(d).length!=0&&(n._tree?h(n._tree,d):(e._render(t),Se(e),tt(e,d)))}},we=({tree:e,store:t})=>En({tree:e,store:t,direction:""},r=>r[0].index),be=({tree:e,store:t})=>En({tree:e,store:t,direction:""},r=>r[r.length-1].index+1),En=({tree:e,store:t,direction:r},n)=>{let l=Ae(e),i={};for(let o of Object.keys(l))i=fr(t,{dstPath:o,startIndex:n(l[o])},{[o]:l[o]});Object.keys(i).length!=0&&(e._render(t),tt(e,i,{direction:r,sync:!!e.sync}))},Q=({tree:e,store:t})=>$n({tree:e,store:t,startIndex:r=>r-1,direction:""}),Z=({tree:e,store:t})=>$n({tree:e,store:t,startIndex:r=>r+1,direction:""}),$n=({tree:e,store:t,startIndex:r,direction:n})=>{let l=Ae(e),i={};for(let o of Object.keys(l)){let a=l[o].sort((s,c)=>s.index-c.index);i=It(t,{dstPath:o,startIndex:r(a[0].index),isRefConstraint:!1},l)}Object.keys(i).length!=0&&(e._render(t),tt(e,i))},xr=(e,t)=>{var a,s,c;let r=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!r)return;let n=q(t,r.id),l=e._walker.currentNode,i=q(t,l.id),o=(u,d)=>{if(!u)return!1;let h=!0;for(let p of d)h=h&&u[p[0]]==p[1];return h};for(let u of t.rulesTable||[])if(o(n,u.selector)){if((s=(a=u.rules)==null?void 0:a.nthChild)==null?void 0:s[i._meta.index])return u.rules.nthChild[i._meta.index].allowedSchs;if((c=u.rules.children)==null?void 0:c.allowedSchs)return u.rules.children.allowedSchs}return null},Ut=({tree:e})=>hr(e),Vt=({tree:e})=>Tr(e);var{defineProperties:li}=Object,yr=({store:e,target:t,view:r,treeKeyDownCmds:n,textAreaKeyDownCmd:l,opts:i={}})=>{li(e,{render:{value:function(a){r(a||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let o=document.querySelector(`${t} [role='tree']`);if(o){o._aria=pr,o._render=r,e._tree=o,_n(o),o.onkeydown=ii(e,n,{textAreaKeyDownCmd:l}),o.onclick=oi(e);let a=o.querySelector(`[id='${CSS.escape(i.selectId)}']`);if(a&&i.selectId!="")o._walker.currentNode=a,E(o,o._walker.currentNode,{focus:i.focus});else{e.currentNode=Ct(o,e.currentNode);let s=o._walker.nextNode(),c=e.currentNode||o._walker.nextNode()||s;E(o,c,{focus:i.focus})}return o._walker.currentNode.scrollIntoView({block:"center"}),o}},ii=(e,t,r)=>function(n){ai(n,this,e,t,r)};async function ai(e,t,r,n=[],l={}){if(e.stopPropagation(),e.target instanceof HTMLTextAreaElement)return ci(e,t,r,l.textAreaKeyDownCmd);switch(e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}let o=new Map(n).get(An(e));!o||(l.denyCmds||[]).includes(o.name)||si(t,r,o)||(o({tree:t,store:r}),t._walker.currentNode=Ct(t,t._walker.currentNode),E(t._walker.currentNode),r.currentNode=t._walker.currentNode,_r(t,t._walker.currentNode,o))}var si=(e,t,r)=>{var s,c,u,d,h,p,y;let n=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!n)return;let l=q(t,n.id),i=e._walker.currentNode,o=q(t,i.id),a=(f,x)=>{if(!f)return!1;let g=!0;for(let _ of x)g=g&&f[_[0]]==_[1];return g};for(let f of t.rulesTable||[])if(a(l,f.selector)&&(((u=(c=(s=f.rules)==null?void 0:s.nthChild)==null?void 0:c[o._meta.index])==null?void 0:u.exceptActions)&&f.rules.nthChild[o._meta.index].exceptActions.map(x=>x.name).includes(r.name)||((d=f.rules.children)==null?void 0:d.onlyActions)&&!f.rules.children.onlyActions.map(x=>x.name).includes(r.name)||((h=f.rules.children)==null?void 0:h.exceptActions)&&f.rules.children.exceptActions.map(x=>x.name).includes(r.name))||a(o,f.selector)&&(((p=f.rules.self)==null?void 0:p.onlyActions)&&!f.rules.self.onlyActions.map(x=>x.name).includes(r.name)||((y=f.rules.self)==null?void 0:y.exceptActions)&&f.rules.self.exceptActions.map(x=>x.name).includes(r.name)))return!0;return!1},ci=(e,t,r,n=[])=>{e.stopPropagation();let l=e.target,o=new Map(n).get(An(e));!o||(o({tree:t,store:r},l),r.currentNode=t._walker.currentNode,_r(t,t._walker.currentNode,o))},oi=e=>function(t){return di(t,this,e)};function di(e,t,r){e.stopPropagation();let n=t._walker.currentNode,l=e.target.closest("[role='treeitem']"),i=!t.querySelector("textarea");if(!!l){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(l)){case Node.DOCUMENT_POSITION_CONTAINS:return E(t,l);case Node.DOCUMENT_POSITION_CONTAINED_BY:return E(t,n);default:if(l.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return E(t,l)}e.shiftKey?(n!=l&&document.getSelection().removeAllRanges(),dt(t,n,l)):e.metaKey?Nn(n,t._walker.currentNode=l):(t._walker.currentNode=l,ft({tree:t},{notFocusIfTextArea:i}),r.currentNode=t._walker.currentNode,_r(t,l,ft))}}var An=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:l})=>{let i=[];return e&&i.push("shift"),(t||n)&&i.push("meta"),r&&i.push("alt"),l&&i.push(l),i.join("-")},_r=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var Sn=new WeakMap,ht=e=>(...t)=>{let r=e(...t);return Sn.set(r,!0),r},Ke=e=>typeof e=="function"&&Sn.has(e);var wr=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,Ft=(e,t,r=null,n=null)=>{for(;t!==r;){let l=t.nextSibling;e.insertBefore(t,n),t=l}},Be=(e,t,r=null)=>{for(;t!==r;){let n=t.nextSibling;e.removeChild(t),t=n}};var U={},ee={};var te=`{{lit-${String(Math.random()).slice(2)}}}`,br=`<!--${te}-->`,On=new RegExp(`${te}|${br}`),lt="$lit$",Gt=class{constructor(t,r){this.parts=[],this.element=r;let n=[],l=[],i=document.createTreeWalker(r.content,133,null,!1),o=0,a=-1,s=0,{strings:c,values:{length:u}}=t;for(;s<u;){let d=i.nextNode();if(d===null){i.currentNode=l.pop();continue}if(a++,d.nodeType===1){if(d.hasAttributes()){let h=d.attributes,{length:p}=h,y=0;for(let f=0;f<p;f++)Dn(h[f].name,lt)&&y++;for(;y-- >0;){let f=c[s],x=qt.exec(f)[2],g=x.toLowerCase()+lt,_=d.getAttribute(g);d.removeAttribute(g);let m=_.split(On);this.parts.push({type:"attribute",index:a,name:x,strings:m}),s+=m.length-1}}d.tagName==="TEMPLATE"&&(l.push(d),i.currentNode=d.content)}else if(d.nodeType===3){let h=d.data;if(h.indexOf(te)>=0){let p=d.parentNode,y=h.split(On),f=y.length-1;for(let x=0;x<f;x++){let g,_=y[x];if(_==="")g=V();else{let m=qt.exec(_);m!==null&&Dn(m[2],lt)&&(_=_.slice(0,m.index)+m[1]+m[2].slice(0,-lt.length)+m[3]),g=document.createTextNode(_)}p.insertBefore(g,d),this.parts.push({type:"node",index:++a})}y[f]===""?(p.insertBefore(V(),d),n.push(d)):d.data=y[f],s+=f}}else if(d.nodeType===8)if(d.data===te){let h=d.parentNode;(d.previousSibling===null||a===o)&&(a++,h.insertBefore(V(),d)),o=a,this.parts.push({type:"node",index:a}),d.nextSibling===null?d.data="":(n.push(d),a--),s++}else{let h=-1;for(;(h=d.data.indexOf(te,h+1))!==-1;)this.parts.push({type:"node",index:-1}),s++}}for(let d of n)d.parentNode.removeChild(d)}},Dn=(e,t)=>{let r=e.length-t.length;return r>=0&&e.slice(r)===t},Nr=e=>e.index!==-1,V=()=>document.createComment(""),qt=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var Tt=class{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(let n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(let n of this.__parts)n!==void 0&&n.commit()}_clone(){let t=wr?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,l=document.createTreeWalker(t,133,null,!1),i=0,o=0,a,s=l.nextNode();for(;i<n.length;){if(a=n[i],!Nr(a)){this.__parts.push(void 0),i++;continue}for(;o<a.index;)o++,s.nodeName==="TEMPLATE"&&(r.push(s),l.currentNode=s.content),(s=l.nextNode())===null&&(l.currentNode=r.pop(),s=l.nextNode());if(a.type==="node"){let c=this.processor.handleTextExpression(this.options);c.insertAfterNode(s.previousSibling),this.__parts.push(c)}else this.__parts.push(...this.processor.handleAttributeExpressions(s,a.name,a.strings,this.options));i++}return wr&&(document.adoptNode(t),customElements.upgrade(t)),t}};var Mn=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),ui=` ${te} `,it=class{constructor(t,r,n,l){this.strings=t,this.values=r,this.type=n,this.processor=l}getHTML(){let t=this.strings.length-1,r="",n=!1;for(let l=0;l<t;l++){let i=this.strings[l],o=i.lastIndexOf("<!--");n=(o>-1||n)&&i.indexOf("-->",o+1)===-1;let a=qt.exec(i);a===null?r+=i+(n?ui:br):r+=i.substr(0,a.index)+a[1]+a[2]+lt+a[3]+te}return r+=this.strings[t],r}getTemplateElement(){let t=document.createElement("template"),r=this.getHTML();return Mn!==void 0&&(r=Mn.createHTML(r)),t.innerHTML=r,t}};var Kt=e=>e===null||!(typeof e=="object"||typeof e=="function"),Bt=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),xt=class{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let l=0;l<n.length-1;l++)this.parts[l]=this._createPart()}_createPart(){return new ot(this)}_getValue(){let t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){let i=n[0].value;if(typeof i=="symbol")return String(i);if(typeof i=="string"||!Bt(i))return i}let l="";for(let i=0;i<r;i++){l+=t[i];let o=n[i];if(o!==void 0){let a=o.value;if(Kt(a)||!Bt(a))l+=typeof a=="string"?a:String(a);else for(let s of a)l+=typeof s=="string"?s:String(s)}}return l+=t[r],l}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},ot=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==U&&(!Kt(t)||t!==this.value)&&(this.value=t,Ke(t)||(this.committer.dirty=!0))}commit(){for(;Ke(this.value);){let t=this.value;this.value=U,t(this)}this.value!==U&&this.committer.commit()}},Y=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(V()),this.endNode=t.appendChild(V())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=V()),t.__insert(this.endNode=V())}insertAfterPart(t){t.__insert(this.startNode=V()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;Ke(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=U,r(this)}let t=this.__pendingValue;t!==U&&(Kt(t)?t!==this.value&&this.__commitText(t):t instanceof it?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):Bt(t)?this.__commitIterable(t):t===ee?(this.value=ee,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let r=this.startNode.nextSibling;t=t==null?"":t;let n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){let r=this.options.templateFactory(t);if(this.value instanceof Tt&&this.value.template===r)this.value.update(t.values);else{let n=new Tt(r,t.processor,this.options),l=n._clone();n.update(t.values),this.__commitNode(l),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let r=this.value,n=0,l;for(let i of t)l=r[n],l===void 0&&(l=new Y(this.options),r.push(l),n===0?l.appendIntoPart(this):l.insertAfterPart(r[n-1])),l.setValue(i),l.commit(),n++;n<r.length&&(r.length=n,this.clear(l&&l.endNode))}clear(t=this.startNode){Be(this.startNode.parentNode,t.nextSibling,this.endNode)}},Wt=class{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;Ke(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=U,r(this)}if(this.__pendingValue===U)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=U}},Ht=class extends xt{constructor(t,r,n){super(t,r,n);this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new gr(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},gr=class extends ot{},In=!1;(()=>{try{let e={get capture(){return In=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();var Yt=class{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=l=>this.handleEvent(l)}setValue(t){this.__pendingValue=t}commit(){for(;Ke(this.__pendingValue);){let i=this.__pendingValue;this.__pendingValue=U,i(this)}if(this.__pendingValue===U)return;let t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),l=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),l&&(this.__options=fi(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=U}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},fi=e=>e&&(In?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var vr=class{handleAttributeExpressions(t,r,n,l){let i=r[0];return i==="."?new Ht(t,r.slice(1),n).parts:i==="@"?[new Yt(t,r.slice(1),l.eventContext)]:i==="?"?[new Wt(t,r.slice(1),n)]:new xt(t,r,n).parts}handleTextExpression(t){return new Y(t)}},kr=new vr;function $r(e){let t=Er.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},Er.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;let n=e.strings.join(te);return r=t.keyString.get(n),r===void 0&&(r=new Gt(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}var Er=new Map;var Ar=new WeakMap,We=(e,t,r)=>{let n=Ar.get(t);n===void 0&&(Be(t,t.firstChild),Ar.set(t,n=new Y(Object.assign({templateFactory:$r},r))),n.appendInto(t)),n.setValue(e),n.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var w=(e,...t)=>new it(e,t,"html",kr);var Pn=(e,t)=>{let r=e.startNode.parentNode,n=t===void 0?e.endNode:t.startNode,l=r.insertBefore(V(),n);r.insertBefore(V(),n);let i=new Y(e.options);return i.insertAfterNode(l),i},He=(e,t)=>(e.setValue(t),e.commit(),e),Sr=(e,t,r)=>{let n=e.startNode.parentNode,l=r?r.startNode:e.endNode,i=t.endNode.nextSibling;i!==l&&Ft(n,t.startNode,i,l)},Or=e=>{Be(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},Rn=(e,t,r)=>{let n=new Map;for(let l=t;l<=r;l++)n.set(e[l],l);return n},Cn=new WeakMap,jn=new WeakMap,Oe=ht((e,t,r)=>{let n;return r===void 0?r=t:t!==void 0&&(n=t),l=>{if(!(l instanceof Y))throw new Error("repeat can only be used in text bindings");let i=Cn.get(l)||[],o=jn.get(l)||[],a=[],s=[],c=[],u=0;for(let g of e)c[u]=n?n(g,u):u,s[u]=r(g,u),u++;let d,h,p=0,y=i.length-1,f=0,x=s.length-1;for(;p<=y&&f<=x;)if(i[p]===null)p++;else if(i[y]===null)y--;else if(o[p]===c[f])a[f]=He(i[p],s[f]),p++,f++;else if(o[y]===c[x])a[x]=He(i[y],s[x]),y--,x--;else if(o[p]===c[x])a[x]=He(i[p],s[x]),Sr(l,i[p],a[x+1]),p++,x--;else if(o[y]===c[f])a[f]=He(i[y],s[f]),Sr(l,i[y],i[p]),y--,f++;else if(d===void 0&&(d=Rn(c,f,x),h=Rn(o,p,y)),!d.has(o[p]))Or(i[p]),p++;else if(!d.has(o[y]))Or(i[y]),y--;else{let g=h.get(c[f]),_=g!==void 0?i[g]:null;if(_===null){let m=Pn(l,i[p]);He(m,s[f]),a[f]=m}else a[f]=He(_,s[f]),Sr(l,_,i[p]),i[g]=null;f++}for(;f<=x;){let g=Pn(l,a[x+1]);He(g,s[f]),a[f++]=g}for(;p<=y;){let g=i[p++];g!==null&&Or(g)}Cn.set(l,a),jn.set(l,c)}});var Dr=new WeakMap,Ln=ht(e=>t=>{let r=Dr.get(t);if(e===void 0&&t instanceof ot){if(r!==void 0||!Dr.has(t)){let n=t.committer.name;t.committer.element.removeAttribute(n)}}else e!==r&&t.setValue(e);Dr.set(t,e)});var zt={};Hr(zt,{ENTRY_MARKED:()=>ct,MOVED:()=>re,NEW:()=>Me,NEW_KEY:()=>Re,NEW_ORDER:()=>Pe,NEW_TYPE:()=>ne,REMOVED:()=>Ie,buildBaseIndices:()=>Mr,diff:()=>xi,mergeToBase:()=>yi,mergeToCurrent:()=>_i});var z="file",at="project",Un=(e,t)=>(Object.assign(t,e),t.fields=[],S(()=>t)),Vn=(e,t)=>A(e,(r,n)=>(r.metadata=t[r.$a],r)),Fn=(e,t)=>{Mr(e);let r=e._indices;for(let n of e.fields)for(let l of n.fields)if(t[l.$a]){let i=Qe(t[l.$a],(o,a)=>(r[a]&&o.push(r[a]),o),[]);i.length!=0&&N(l,"referrers",i)}},st=(e,t,r)=>(t||(t=Gn()),Object.assign(t,e),S(()=>t)),Kn=()=>qn({taggedLevel:{1:at,2:z,3:L},allowedSchs:[Gn],put:{pos:"prepend",onlyDst:{[z]:!0}}}),Gn=()=>qn({taggedLevel:{1:z,2:L},addDefault:H,entryable:[L],put:{pos:"prepend"},rulesTable:Ir}),qn=(e={})=>{let t=S(H);return t.allowedSchs=(e.allowedSchs||Pr).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.t==e.addDefault().t)&&e.addDefault()),e.rulesTable&&(t.rulesTable=e.rulesTable),t},yt=(e,t)=>q(e,`[${t}]`)||e._currentFileStore,De=e=>{let t={};return Rr(e,(r,n)=>{t[r.$a]={display:[n.file.key,r.key].join(" :: "),file:n.file.key,fmodel:r.key,sch:r}}),t},Rr=(e,t)=>{for(let r of e.fields)for(let n=0;n<r.fields.length;n++)r.fields[n]=t(r.fields[n],{path:`[${r.key}][${r.fields[n].key}]`,file:r})||r.fields[n]},Pr=[At,H,dn,un,fn,ve,Xr,sn,()=>St('"json string"'),Qr,Zr,en,tn,rn,nn,ln,on,an,pn,mn,cn,()=>ke(null)],mi={selector:[["t",ie]],rules:{self:{exceptActions:[J,X]},children:{exceptActions:[Ge,qe,we,be,B,Q,Z]},nthChild:[{allowedSchs:[At()]}]}},hi={selector:[["t",F]],rules:{self:{exceptActions:[J,X]},children:{exceptActions:[Ge,qe,we,be,B,Q,Z]},nthChild:[{allowedSchs:[ke(null,{to:H()})]},{allowedSchs:[H()],exceptActions:[nt,_e]}]}},Ti={selector:[["t",I]],rules:{children:{min:1,allowedSchs:[H(),ke(null,{to:H()})]}}},Ir=[mi,Ti,hi];var Me="new",Ie="removed",re="moved",Pe="order_changed",Re="key_changed",ne="type_changed",ct="entry_changed",Mr=e=>{let t={};return A(e,(r,n)=>(N(r,"_meta",n),Object.assign(t,{[r.$a]:r}),delete r._visit,delete r._pruned,r)),N(e,"_indices",t),e},xi=(e,t,r={})=>{let n=[],l=t._indices;A(e,(o,a)=>{delete o._diff;let s={},c=l[o.$a];if(c){let u=a.parent,d=c._meta.parent;d.$a!=u.$a&&Object.assign(s,{[re]:{oldParent:d,newParent:u,oldPath:c._meta.path,newPath:a.path}}),c._meta.index!=a.index&&d.$a==u.$a&&Object.assign(s,{[Pe]:{oldOrder:c.index,newOrder:o.index}}),c.t!=o.t&&Object.assign(s,{[ne]:{oldType:c.t,newType:o.t,parent:u}}),c.$r!=o.$r&&Object.assign(s,{[ne]:{oldType:c.$r,newType:o.$r,parent:u}}),c.v!=o.v&&Object.assign(s,{[ne]:{oldType:c.v,newType:o.v,parent:u}}),c.key!=o.key&&Object.assign(s,{[Re]:{oldKey:c.key,newKey:o.key,parent:u}}),c.isEntry!=o.isEntry&&Object.assign(s,{[ct]:{oldIsEntry:c.isEntry,newIsEntry:o.isEntry,parent:u}}),Object.keys(s).length!=0&&(N(o,"_diff",Object.assign(s,{meta:Cr(a)})),n.push(o)),N(c,"_visit",!0)}else N(o,"_diff",{[Me]:{parent:a.parent},meta:Cr(a)}),n.push(o);return o});let i=[];return A(t,(o,a)=>(o._visit||(N(o,"_diff",{[Ie]:{parent:a.parent},meta:Cr(a)}),i.push(o),N(o,"_pruned",!0)),delete o._visit,o)),n=n.concat(i),n},Cr=({level:e,path:t,lpath:r,parent:n})=>({level:e,path:t,lpath:r,pa:n.$a}),yi=(e,t)=>(e._indices||(e._indices={}),Wn(e,t.removed),Hn(e,t.added),Bn(e,t.changed),Yn(e,t.reorder),e),_i=(e,t)=>(Wn(e,t.removed),Hn(e,t.added),Bn(e,t.changed),Yn(e,t.reorder),e),Bn=(e,{fmodels:t,files:r})=>{zn(e,r,(n,l)=>{let{key:i,index:o}=l;return Object.assign(n,{key:i,index:o})}),zn(e,t,(n,l)=>l)},zn=(e,t,r=n=>n)=>{let n={};for(let o of t)n[o.$a]=o;let l=[];A(e,(o,a)=>(Object.keys(n).length==0&&(o._halt=!0),n[o.$a]&&(o=r(o,n[o.$a]),l.push(o),delete n[o.$a]),o));let i={};for(let o of l)A(o,(a,s)=>(i[a.$a]=a,a));e._indices&&A(e,(o,a)=>(Object.keys(i).length==0&&(o._halt=!0),i[o.$a]&&(N(o,"_visit",!0),N(o,"_meta",a),e._indices[o.$a]=o,delete o._diff,delete i[o.$a]),o))},Wn=(e,{fmodels:t,files:r})=>{Jn(e,r,n=>st(n)),Jn(e,t)},Jn=(e,t)=>{var l;let r={};for(let i of t)r[l=i.pa]||(r[l]=[]),r[i.pa].push(i.$a);let n=(i,o)=>o.reduce((a,s,c)=>(r[i.$a].includes(s.$a)&&a.push(c),a),[]);if(sr(e,(i,o)=>(Object.keys(r).length==0&&(i._halt=!0),r[i.$a]),(i,o)=>{let a=[];switch(!0){case i.hasOwnProperty("fields"):a=n(i,i.fields);break;case i.hasOwnProperty("schs"):a=n(i,i.schs);break}return delete r[i.$a],a}),e._indices)for(let i of t)delete e._indices[i.$a]},Hn=(e,{fmodels:t,files:r})=>{Xn(e,r,n=>st(n)),Xn(e,t)},Xn=(e,t,r=n=>n)=>{var i;let n={};for(let o of t)n[i=o.pa]||(n[i]=[]),n[o.pa].push({k:o.key,sch:()=>yn(r(o)),index:o.index});Ze(e,(o,a)=>(Object.keys(n).length==0&&(o._halt=!0),n[o.$a]),(o,a)=>{let s=n[o.$a];return delete n[o.$a],s});let l={};for(let o of t)A(o,(a,s)=>(l[a.$a]=a,a));e._indices&&A(e,(o,a)=>(Object.keys(l).length==0&&(o._halt=!0),N(o,"_visit",!0),N(o,"_meta",a),e._indices[o.$a]=o,delete o._diff,delete l[o.$a],o))},Yn=(e,{fmodels:t,files:r})=>{Qn(e,r,n=>st(n)),Qn(e,t)},Qn=(e,t)=>{var i;let r={};for(let o of t){let{$a:a,index:s}=o;r[i=o.pa]||(r[i]=[]),r[o.pa].push({$a:a,index:s})}let n=(o,a)=>{let s={};for(let c of a)s[c.$a]=c;return r[o.$a].sort((c,u)=>c.index-u.index).map(c=>s[c.$a])};$e(e,(o,a)=>(Object.keys(r).length==0&&(o._halt=!0),r[o.$a]),(o,a)=>{switch(!0){case o.hasOwnProperty("fields"):o.fields=n(o,o.fields);break;case o.hasOwnProperty("schs"):o.schs=n(o,o.schs);break}return delete r[o.$a],o});let l={};for(let o of t)l[o.$a]=o;e._indices&&A(e,(o,a)=>(Object.keys(l).length==0&&(o._halt=!0),N(o,"_visit",!0),N(o,"_meta",a),e._indices[o.$a]=o,delete o._diff,delete l[o.$a],o))};var Zn=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),_t(e,"title",t),_t(e,"description",t),bi(e,"rw",["rw","r","w"],t),jr(e,"required",t),wi(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},wi=(e,t)=>{switch(e.t){case M:ki(e,t);break;case C:Ei(e,t);break;case G:$i(e,t);break;case j:Ai(e,t);break;case I:Si(e,t);break;case oe:Ni(e,t);break;case ae:case ce:case ue:case se:case de:case fe:el(e,t,{min:e.min,max:e.max});break;case pe:case me:el(e,t);break;case he:gi(e,t);break;case ge:vi(e,t);break}},Ni=(e,t)=>{Oi(e,"pattern",t),Ne(e,"min",t,{min:0}),Ne(e,"max",t,{min:0}),wt(e,t),_t(e,"default",t,Object.assign(tl(e,["min","max","pattern"]),{ignoreEmpty:!0}))},gi=(e,t)=>{jr(e,"default",t)},el=(e,t,r)=>{Jt(e,"min",t,r),Jt(e,"max",t,r),Ne(e,"multipleOf",t),wt(e,t),Jt(e,"default",t,tl(e,["min","max","multipleOf"]))},vi=(e,t)=>{Di(e,"default",t)},ki=(e,t)=>{Ne(e,"min",t,{min:0}),Ne(e,"max",t,{min:0}),wt(e,t)},Ei=(e,t)=>{Ne(e,"min",t,{min:1}),Ne(e,"max",t,{min:1}),wt(e,t),jr(e,"unique",t)},$i=(e,t)=>{Ne(e,"min",t,{min:1}),Ne(e,"max",t,{min:1}),wt(e,t)},Ai=(e,t)=>{},Si=(e,t)=>{_t(e,"tagname",t,{min:1})},tl=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},_t=(e,t,r,n={})=>{if(!r.hasOwnProperty(t)||n.ignoreEmpty&&r[t]=="")return;let l=r[t],i=2**18;(a=>new Blob([a]).size)(l)>i?D(e,t,`string size limit is ${Math.ceil(i/1024)} KB`):n.max&&l.length>n.max?D(e,t,`must be less than or equal ${n.max} length`):n.min&&l.length<n.min?D(e,t,`must be grater than or equal ${n.min} length`):n.pattern?new RegExp(n.pattern).test(l)||D(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=l},jr=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let n=!!r[t];e.changes[t]=n},Jt=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return;let l=Lr(r[t]);!l&&l!=0?D(e,t,"must be number"):n.min&&l<n.min?D(e,t,`must be greater than or equal ${n.min}`):n.max&&l>n.max?D(e,t,`must be less than than or equal ${n.max}`):n.multipleOf&&l%n.multipleOf!=0?D(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=l},Ne=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return;Jt(e,t,r,n);let l=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?D(e,t,"must be integer number"):l>Number.MAX_SAFE_INTEGER?D(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):l<Number.MIN_SAFE_INTEGER&&D(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},Oi=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(_t(e,t,r),(e.errors[t]||[]).length==0))try{let n=r[t];if(n=="")return;e.changes[t]=new RegExp(n)}catch(n){D(e,t,"invalid regex")}},wt=(e,t)=>{if(t.min&&t.max){let r=Lr(t.min),n=Lr(t.max);(r||r==0)&&(n||n==0)&&r>n&&(D(e,"min","min is greater than max"),D(e,"max","max is less than min"))}},Di=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?D(e,t,"must be null"):e.changes[t]=r[t])},bi=(e,t,r,n)=>{!n.hasOwnProperty(t)||(r.includes(n[t])?e.changes[t]=n[t]:D(e,t,"value must be r, w, or rw"))},D=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Lr=e=>Mi(e,"number");var Mi=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=i=>["checkbox","radio"].includes(i.type)?i.checked:i.value,r=this.querySelector("form").elements,n={};for(let i=0;i<r.length;i++){let o=t(r[i]);!(r[i]instanceof HTMLTextAreaElement)&&o==""||(n[r[i].name]=o)}let l={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:l,bubbles:!0}))}}});customElements.define("autosize-text",class extends HTMLElement{static get observedAttributes(){return["data-value"]}attributeChangedCallback(e,t,r){this.autosize(r)}connectedCallback(){this.autosize.bind(this)()}autosize(e){for(let t of this.getElementsByTagName("textarea"))e||(e=t.value),e&&(t.value=e,Xe({target:t}))}});var rl=e=>We(Oe([{$a:"nothing"}],t=>t.$a,t=>ee),document.querySelector(e)),Ur=(e,t,r)=>{try{let n=t.referrers||[];We(Oe([t],l=>l.$a,l=>w`
    <p class="meta-def">${Pi(r.key,l._meta.path)||"-"}</p>
    <p>${Ee(l.t)}</p>
    <form data-path="${l._meta.path}" data-file="${r.key}" class="fbox">
      ${bt(l,"title",{keyDisplay:"Title"})}
      ${bt(l,"description",{keyDisplay:"Description"})}
      ${ji(l)}
      ${Ri(l,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:$(l,"rw")||"rw",keyDisplay:"Read / Write"})}
      ${Ci(l,"default",{keyDisplay:"Default",min:$(l,"min"),max:$(l,"max")})}
    </form>
    ${Ii(n)}
  `),document.querySelector(e))}catch(n){console.log(n)}},Ii=e=>e.length!=0?w`
    <p>Referrers</p>
      <ul>
        ${e.map(t=>w`<li>${t._meta.lpath.slice(1).map(r=>r.key).join(" / ")}</li>`)}
      </ul>
    `:ee,Pi=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(n=>n!=""),t.splice(0,0,e);let r=w`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(n=>[w`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(n)]),t.splice(0,0,r),t},Nt=(e,t,r,n={})=>{var l;return w`
  <label class="${n.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${n.keyDisplay||t} ${n.readonly&&w`<span>Â· readonly</span>`}</p>
    ${r}
    ${(l=Xt(e,t))==null?void 0:l.map(i=>w`<p class="err">${i}</p>`)}
  </label>
  `},bt=(e,t,r={})=>Nt(e,t,w`
    <autosize-text data-value="${$(e,t)||""}">
      <textarea name="${gt(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${Xt(e,t)&&"invalid"}" @input="${Xe}">${r.value||$(e,t)||""}</textarea>
    </autosize-text>
  `,r),Ye=(e,t,r={})=>Nt(e,t,w`
    <input type="number" name="${gt(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||$(e,t)}" ?readonly="${r.readonly}" class="${Xt(e,t)&&"invalid"}">
  `,r),Ce=(e,t,r={})=>Nt(e,t,w`
    <input type="number" name="${gt(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||$(e,t)}" ?readonly="${r.readonly}" class="${Xt(e,t)&&"invalid"}">
  `,r),Vr=(e,t,r={})=>Nt(e,t,w`
    <input type="checkbox" name="${gt(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||$(e,t)}">
  `,r),Ri=(e,t,r={})=>Nt(e,t,w`
    <select name="${gt(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,l])=>w`<option value="${n}" ?selected="${(r.selected||$(e,t))==n}">${l}</option>`)}
    </select>
  `,r),Ci=(e,t,r={})=>{switch(e.t){case he:return Vr(e,t,r);case ae:case ce:case ue:case se:case de:case fe:case pe:case me:return Ye(e,t,r);case oe:return bt(e,t,r);default:return""}},gt=(e,t)=>t,$=(e,t)=>(e.metadata||{})[t],ji=e=>{let t;switch(e.t){case M:let i=0;for(let o of e.fields)$(o,"required")&&i++;t=[Ce(e,"min",{keyDisplay:"Min Properties",value:i,readonly:!0}),Ce(e,"max",{keyDisplay:"Max Properties",value:e.fields.length,min:Math.max($(e,"min")||0,0)})];break;case C:t=[Ce(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:$(e,"max")}),Ce(e,"max",{keyDisplay:"Max Items",min:$(e,"min")}),Vr(e,"unique",{keyDisplay:"Item uniqueness"})];break;case G:t=[Ce(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),Ce(e,"max",{keyDisplay:"Max Items",value:$(e,"max")||e.schs.length})];break;case I:t=[bt(e,"tagname",{keyDisplay:"Tag name",value:e.tagname})];break;case oe:t=[Ce(e,"min",{keyDisplay:"Min Length",min:0,max:$(e,"max")}),Ce(e,"max",{keyDisplay:"Max Length",min:Math.max(0,$(e,"min"))}),bt(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case ae:case ce:case ue:case se:case de:case fe:t=[Ye(e,"min",{keyDisplay:"Min",min:e.min,max:Math.min($(e,"max"),e.max)}),Ye(e,"max",{keyDisplay:"Max",min:Math.max($(e,"min"),e.min),max:e.max}),Ye(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min($(e,"max"),e.max)})];break;case pe:case me:t=[Ye(e,"min",{keyDisplay:"Min",max:$(e,"max")}),Ye(e,"max",{keyDisplay:"Max",min:$(e,"min")}),Ye(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:$(e,"max")})];break;case he:t=[];case ge:t=[];case j:t=[];case Je:t=[];case W:t=[];case Te:t=[];default:t=[]}let r=e._meta.parent.t==M,n=e._meta.level>2,l=!e.isKeyPattern;return r&&n&&l&&t.push(Vr(e,"required",{keyDisplay:"Required"})),t},Xt=(e,t)=>e.errors&&e.errors[t];var nl=e=>We(w`<ul role="tree"></ul>`,document.querySelector(e)),Fr=(e,t,r={})=>{var n;try{let l={level:1,tab:((n=r.ui)==null?void 0:n.tab)||0,models:t._models||{},taggedLevel:t.taggedLevel};l.rootLevel=l.level,Object.assign(l,r.ui),r.ui.lineClass&&Object.assign(l,{tab:r.ui.tab+2}),Li(e,{sch:t,ui:l,path:t.path||"",key:t.key,parent:t})}catch(l){console.log(l)}},Li=(e,t)=>We(w`
  <ul role="tree" aria-multiselectable="true" class="${`${t.ui.lineClass||""} text-sm`}" aria-labelledby="${Gr(t.ui)+"_tree"}">
    ${vt(t)}
  </ul>
  `,document.querySelector(e)),qr=e=>Ln(Gr(e)),Gr=e=>e.taggedLevel[e.level],ll=e=>{let t;if(!e)return"";for(let r of Object.keys(e))switch(r){case Me:t="N";break;case Ie:t="R";break;case re:t="M";break;case Pe:t="O";break;case Re:t="C";break;case ne:t="C";break;case ct:t="C";break}return t||""},vt=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Object.assign(e.ui,{expanded:!0}),Ui(e);case[C].includes(e.sch.t):return e.sch.sch.hasOwnProperty("fields")||e.sch.sch.hasOwnProperty("schs")?Object.assign(e.ui,{expanded:!0}):Object.assign(e.ui,{expanded:!1}),il(e);case(e.sch.hasOwnProperty("fields")||e.sch.hasOwnProperty("schs")):return Object.assign(e.ui,{expanded:!0}),il(e);default:return Vi(e)}},Ui=e=>w`
  <li id="${e.path}" data-tag="${qr(e.ui)}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${Gr(e.ui)}_tree">
      ${Kr(e.key)}
    </dfn>
    <ul data-group="${al(e.sch)}" role="group" tabindex="-1">
      ${ol(e)}
    </ul>
  </li>`,il=e=>w`
  <li id="${e.path}" data-tag="${qr(e.ui)}" .key="${e.key}" .index="${e.ui.index}" .refed=${!!e.sch.referrers} aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" data-diff="${ll(e.sch._diff)}" data-group-size="${Fi(e.sch)}">
      ${sl(Object.assign(e,{key:Kr(e.key)}))}
      ${cl(e)}
    </dfn>
    <ul data-group="${al(e.sch)}" role="group">
      ${ol(e)}
    </ul>
  </li>`,Vi=e=>w`
  <li id="${e.path}" data-tag="${qr(e.ui)}" data-diff="${ll(e.sch._diff)}" .key="${e.key}" .index="${e.ui.index}" .refed=${!!e.sch.referrers} aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${sl(Object.assign(e,{key:Kr(e.key)}))}
    ${cl(e)}
  </li>`,ol=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return ee;switch(!0){case[M,I].includes(e.sch.t):return Gi(e);case[G,ie,F].includes(e.sch.t):return qi(e);case[C].includes(e.sch.t):return Ki(e);case[j].includes(e.sch.t):return Bi(e);default:return ee}},Gi=e=>Oe(e.sch.fields,t=>t.$a,(t,r)=>vt({key:t.key,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${t.key}]`})),qi=e=>Oe(e.sch.schs,t=>t.$a,(t,r)=>vt({key:r,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),Ki=e=>Oe([e.sch.sch],t=>t.$a,(t,r)=>vt({key:r,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),Bi=e=>Oe(e.sch.schs,t=>t.$a,(t,r)=>vt({key:"",sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),le=(e,t=0)=>`padding-left: ${(e.ui.level-1)*2+e.ui.tab-1+t}ch`,dl=(e,t,r)=>w`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  @input="${Xe}"
  @focus="${hn}"
  >${r}</textarea>`,sl=e=>e.ui.level==e.ui.rootLevel+1?Wi(e):Hi(e),Wi=e=>w`
  <span class="def" style="${le(e)}">
    ${Yi(e.sch,e.ui)}
  </span>
  <span class="k">${Qt(e)}</span>
  <span class="s">=</span>
  `,Hi=e=>{var t;switch(!0){case e.parent.t==j:return w`
      <span class="s" style="${le(e,1)}">|</span>
      `;case(e.parent.t==ie&&e.sch.$a==e.parent.schs[0].$a):return w`
      <span class="s" style="${le(e)}">k</span>
      `;case(e.parent.t==ie&&e.sch.$a==e.parent.schs[1].$a):return w`
      <span class="s" style="${le(e)}">v</span>
      `;case(e.parent.t==F&&e.sch.$a==e.parent.schs[0].$a):return w`
      <span class="s" style="${le(e)}">extends</span>
      `;case(e.parent.t==F&&e.sch.$a==e.parent.schs[1].$a):return w`
      <span class="s" style="${le(e)}">record</span>
      `;case e.parent.t==C:return w`
      <span class="s" style="${le(e)}">â</span>
      `;case e.parent.t==M:return w`
      <span class="k" style="${le(e,1)}" data-required="${!!((t=e.sch.metadata)==null?void 0:t.required)}">
        ${Qt(e)}
      </span>
      <span class="s">:</span>
    `;case e.parent.t==I:return w`
      <span class="s" style="${le(e,.5)}">|</span>
      <span class="k tag">
        ${Qt(e)}
      </span>
      <span class="s">Â·</span>
    `;default:return w`
      <span class="k" style="${le(e,1)}">
        ${Qt(e)}
      </span >
      <span class="s">:</span>
    `}},Qt=e=>e.sch.uiMode=="editKey"?dl("key-edit",e.ui.parentPath,e.key):w`${e.key}`,cl=e=>e.ui.level==e.ui.rootLevel+1?zi(e):Ji(e),zi=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):w`<span class="t">${ul(e)}</span>`,Ji=e=>w`<span class="t">${ul(e)}</span>`,ul=e=>e.sch.uiMode=="editType"?w`<combo-box id="type_search" list="typesearch">
      ${dl("type-edit",e.ui.parentPath,Br(e.sch,e.ui))}
    </combo-box>`:w`${fl(e.sch,e.ui)}`,Br=(e,t)=>{var r;switch(!0){case e.t==Te:return JSON.stringify(e.v);case e.t==W:return(r=t.models[e.$r])==null?void 0:r.display;default:return Ee(e.t)}},fl=(e,t)=>{let r,n=e.metadata;switch(!0){case(e.t==M&&e.fields.length==0):r="{ any }";break;case e.t==M:r="{ \xA0 }";break;case e.t==F:r="e { }";break;case e.t==C:r=w`[\xa0 ${fl(e.sch,t)} \xa0]`;break;case e.t==G:r="( \xA0 )";break;case e.t==ie:r="dict";break;case e.t==j:r="||";break;case e.t==I:r=`|| ${(n==null?void 0:n.tagname)||e.tagname}`;break;case e.t==oe:r="string";break;case e.t==ae:r="int_8";break;case e.t==ce:r="int_16";break;case e.t==ue:r="int_32";break;case e.t==se:r="uint_8";break;case e.t==de:r="uint_16";break;case e.t==fe:r="uint_32";break;case e.t==pe:r="float_32";break;case e.t==me:r="float_64";break;case e.t==$t:r="timestamp";break;case e.t==he:r="bool";break;case e.t==ge:r="null";break;case e.t==Je:r="any";break;case(e.t==W&&!!t.models[e.$r]):Ot(e,"_text",Br(e,t)),r=w`<span class="ref">${e._text}</span >`;break;case(e.t==W&&e.$r==null):r=w`<span class="ref notfound" title="Ref type">nothing</span>`;break;case e.t==W:r=w`<span class="ref notfound" title="Ref type">${`${e._text||e.$r} (#404)`}</span>`;break;case e.t==Te:r=w`<span class="value" title="Value type">${Br(e,t)}</span>`;break;default:r="# UNDEFINED_TYPE #"}return t.tText&&(r=t.tText(e,t)||r),r},Kr=e=>e,al=e=>{switch(!0){case[M,I].includes(e.t):return"keyed";case[G,j,F].includes(e.t):return"indexed";default:return"none"}},Fi=e=>{switch(!0){case[M,I].includes(e.t):return e.fields.length;case[G,j,F].includes(e.t):return e.schs.length;case[C].includes(e.t):return 1;default:return 0}},Yi=(e,t)=>{let r;switch(!0){case e.t==M:r="record";break;case e.t==C:r="list";break;case e.t==G:r="tuple";break;case e.t==j:r="union";break;case e.t==I:r="tagged union";break;case e.t==F:r="extensible union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r};var{selectMultiNodeUpTo:pl,selectMultiNodeDownTo:ml,selectMultiNodeUp:hl,selectMultiNodeDown:Tl,selectUpEnd:xl,selectDownEnd:yl,selectUp:_l,selectDown:wl,selectRoot:bl,selectLast:Nl}=Lt,gl=({store:e,target:t,select:r,focus:n=!0})=>{yr({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",pl],["shift-meta-ArrowDown",ml],["shift-ArrowUp",hl],["shift-ArrowDown",Tl],["meta-ArrowUp",xl],["meta-ArrowDown",yl],["ArrowUp",_l],["ArrowDown",wl],["Home",bl],["End",Nl],["shift-+",J],["Enter",rt],["Delete",B],["meta-v",X],["alt-ArrowUp",Q],["alt-ArrowDown",Z]],textAreaKeyDownCmd:[["Enter",_e],["Escape",pt]],view:l=>Fr(t,l||e,{ui:{depthLimit:2,tab:0,modelTypeText:(i,o)=>"file",typeText:(i,o)=>{if(i.t==T.RECORD)return"record";if(i.t==T.VALUE)return"value";if(i.t==T.TUPLE)return"tuple";if(i.t==T.UNION)return"union"},viewTypeTop:i=>""}}),opts:{focus:n,selectId:r}})},Zt=({store:e,target:t,select:r,focus:n,nothing:l=!1})=>{yr({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",pl],["shift-meta-ArrowDown",ml],["shift-ArrowUp",hl],["shift-ArrowDown",Tl],["meta-ArrowUp",xl],["meta-ArrowDown",yl],["ArrowUp",_l],["ArrowDown",wl],["Home",bl],["End",Nl],["shift-+",J],["Enter",rt],["shift-Enter",nt],["Delete",B],["m",mt],["meta-x",Ge],["meta-c",qe],["meta-v",X],["shift-alt-ArrowUp",we],["shift-alt-ArrowDown",be],["alt-ArrowUp",Q],["alt-ArrowDown",Z],["ArrowRight",Ut],["ArrowLeft",Vt],["Escape",({tree:i})=>Se(i)]],textAreaKeyDownCmd:[["Enter",_e],["Escape",pt]],view:i=>Fr(t,i||e,{ui:{lineClass:"setnu",tab:3,modelTypeText:(o,a)=>o.isEntry?"entrypoint":"type"}}),opts:{focus:n,selectId:r}})},er=({store:e,target:t,treeTarget:r})=>{let n=document.querySelector(t),l=document.querySelector(`${r} [role='tree']`);!n||!l||(N(e,"renderSchMeta",function(i){Xi({tree:l,store:i||this,metaForm:t})}),e.renderSchMeta())},Xi=({tree:e,store:t,metaForm:r})=>{let n=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(n.length==1){let l=q(t,n[0].id);l&&Ur(r,l,t)}},vl=e=>nl(e),kl=e=>rl(e);var{selectMultiNodeUpTo:El,selectMultiNodeDownTo:$l,selectMultiNodeUp:Al,selectMultiNodeDown:Sl,selectUpEnd:Qi,selectDownEnd:Zi,selectUp:eo,selectDown:to,selectRoot:Ol,selectLast:ro}=Lt,Dl=(e,t,r,n)=>{let l=t.closest("[data-tag='file']"),i=l==null?void 0:l.key;t.closest("[id='project']")?no(e,i,r,n):t.closest("[id='fmodel']")&&lo(e,i,t,r,n)},no=(e,t,r,n)=>{switch(r){case rt:case Q:case Z:case El:case $l:case Al:case Sl:case Ol:break;case J:case B:case we:case be:case _e:case ft:case Qi:case Zi:case eo:case to:case ro:Wr(e,t);break;case X:e.render();break}},lo=(e,t,r,n,l)=>{switch(n){case Ol:case El:case $l:case Al:case Sl:case Q:case Z:case Ut:case Vt:case pt:case rt:case nt:case Ge:case qe:return}let i=yt(e,t);switch(r.dataset.tag){case z:switch(n){case J:case B:case X:i._models=De(e),e.render();break}break;case L:switch(n){case mt:Ml(r,e,t),i.render();break;case B:i._models=De(e),e.render();break;case we:case be:Ml(r,e,t),i._models=De(e),i.render(),e.render();break;case _e:i._models=De(e),i.render()}break}i.renderSchMeta()},Wr=(e,t,r=null,n=!1)=>{let l=yt(e,t);if(l){if(N(e,"_currentFileStore",l),l._models=De(e),Zt({store:l,target:"[id='fmodel']",select:r,focus:n}),er({store:l,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard){let i=document.querySelector("[id='fmodel'] [role='tree']");i._aria.clearClipboard(i)}}else if(e.fields.length==0){let i=document.querySelector("[id='fmodel'] [role='tree']");vl("[id='fmodel']"),kl("[id='fsch']")}},Ml=(e,t,r)=>{e.dataset.tag==L&&Rr(t,(n,l)=>(l.path!=`[${r}]${e.id}`&&n.isEntry&&delete n.isEntry,n))},Il={update:({store:e,detail:t})=>{let{path:r,attrs:n}=t,l=ye(e,r,(i,o)=>Zn(i,n));return l&&(e.render&&e.render(e),e.renderSchMeta&&e.renderSchMeta(e)),l}},Pl=e=>[J,B,_e,X,we,be,Q,Z,B,mt].map(t=>t.name).includes(e);var{assign:je}=Object,Rl=(e,t)=>{var p,y,f,x,g;let r={},n=_=>{if(r[_])return r[_];for(let m of e.fields)for(let b of m.fields)if(r[b.key]={file:m,fmodelOf:b},b.key==_)return r[_]},l=_=>$e(e,(m,b)=>{if(e.taggedLevel[b.level]==L&&b.path!="")return _.startsWith(b.path)},(m,b)=>(N(m,"_meta",b),m)),i=({$a:_,key:m,index:b,t:v})=>({$a:_,key:m,index:b,t:v}),o=_=>i(_),a=e._diffToRemote;if(!a)return;let s={};s.files=[],s.fmodels=[],s.subfmodels=[];for(let _ of a){let m=e.taggedLevel[_._diff.meta.level];m==at?s.project=_:m==z?s.files.push(_):m==L?s.fmodels.push(_):s.subfmodels.push(_)}let c={},u={},d={},h={};u.files||(u.files={}),u.fmodels||(u.fmodels={}),d.files||(d.files={}),d.fmodels||(d.fmodels={}),c.files||(c.files={}),c.fmodels||(c.fmodels={}),h.files||(h.files={}),h.fmodels||(h.fmodels={}),s.project&&(c.project=o(s.project));for(let _=0;_<s.files.length;_++){let m=s.files[_],b=i(m),v=m._diff.meta.path;if(m._diff[Me]){u.files[v]=b;for(let k of m.fields)u.fmodels[`[${m.key}][${k.key}]`]=je(k,{pa:b.$a})}else m._diff[Ie]?d.files[v]={$a:b.$a}:m._diff[Pe]?xe(e.fields,(k,R)=>{h.files[`[${k.key}]`]=i(Object.assign(k,{index:R}))}):m._diff[re]?console.log("project does not permit as parent for moving items"):(m._diff[Re]&&(c.files[v]=b),m._diff[ne]&&console.log("file type is always record, cannot be changed"))}for(let _=0;_<s.fmodels.length;_++){let m=s.fmodels[_],b=m._diff.meta.path,v=m._diff.meta.pa;if(m._diff[Me])u.fmodels[b]=je(m,{pa:v});else if(m._diff[Ie])d.fmodels[b]={$a:m.$a,pa:v};else if(m._diff[Re]||m._diff[ne]||m._diff[ct])c.fmodels[b]=je(m,{pa:v});else if(m._diff[Pe]){let k=m._diff.meta.lpath[1];h.fmodels[`[${k.key}][${m.key}]`]||xe(k.fields,(R,P)=>{h.fmodels[`[${k.key}][${R.key}]`]={$a:R.$a,t:R.t,key:R.key,index:P,pa:k.$a}})}else if(m._diff[re]){let{oldParent:k,newParent:R,oldPath:P,newPath:Le}=m._diff[re],Ue,ze,kt,Ve,tr;switch(e.taggedLevel[k.level]){case at:console.log("fmodel was not possible to be a file");break;case z:Ve=k,d.fmodels[P]={$a:m.$a,pa:Ve.$a};break;case L:default:Ve=k.lpath[1],tr=k.lpath[2]||k,kt=`[${Ve.key}][${tr.key}]`,console.log(k.lpath.map(Cl=>Cl.key)),ze=((p=e._indices)==null?void 0:p[tr.$a])||l(kt),c.fmodels[kt]=je(ze,{pa:Ve.$a})}switch(e.taggedLevel[R.level]){case z:Ue=R,ze=m,u.fmodels[Le]=je(ze,{pa:Ue.$a});break;default:console.log("fmodel parent can only be file tag")}}}for(let _=0;_<s.subfmodels.length;_++){let m,b,v,k,R,P=s.subfmodels[_];if(P._diff[Me]||P._diff[Ie]||P._diff[Pe]||P._diff[Re]||P._diff[ne])m=P._diff.meta.lpath[1],b=P._diff.meta.lpath[2],v=`[${m.key}][${b.key}]`,!u.fmodels[v]&&!d.fmodels[v]&&((y=c.fmodels)[v]||(y[v]=je(b,{pa:m.$a})));else if(P._diff[re]){let{oldParent:Le,newParent:Ue,oldPath:ze,newPath:kt}=P._diff[re];switch(e.taggedLevel[Le.level]){case at:console.log("subfmodel was not possible to be a file");break;case z:k=Le,d.fmodels[ze]={$a:P.$a,pa:k.$a};break;case L:default:k=Le.lpath[1],R=Le.lpath[2]||Le,v=`[${k.key}][${R.key}]`,b=((f=e._indices)==null?void 0:f[R.$a])||l(v),(x=c.fmodels)[v]||(x[v]=je(b,{pa:k.$a}))}switch(e.taggedLevel[Ue.level]){case at:console.log("subfmodel parent can only be fmodel or subfmodel");break;case z:console.log("subfmodel parent can only be fmodel or subfmodel");break;case L:default:m=Ue.lpath[1],b=Ue.lpath[2]||xn(m.fields,Ve=>Ue.key==Ve.key),v=`[${m.key}][${b.key}]`,(g=c.fmodels)[v]||(g[v]=je(b,{pa:m.$a}))}}}return console.log({added:u,changed:c,removed:d,reorder:h,type:"diff_to_persist"}),t({changed:c,added:u,removed:d,reorder:h})};var io={createProjectStore:Kn,getFileStore:yt,anchorsModels:De,projectToStore:Un,fileToStore:st,controller:Dl,mergeSchMetas:Vn,mergeReferrers:Fn,changeFile:Wr,taggedDiff:Rl,isDiffableCmd:Pl,SchMeta:Il,allSchs:Pr,rulesTable:Ir};export{zt as Diff,Zt as FmodelTree,io as Project,gl as ProjectTree,er as SchMetaForm,Ee as tstr};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
